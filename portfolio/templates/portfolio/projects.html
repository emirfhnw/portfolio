{% extends "portfolio/base.html" %}
{% load static %}
{% block title %}Projekte · Portfolio{% endblock %}

{% block content %}
<section class="section">
  <header class="section-head">
    <h1>Projekte</h1>
    <p class="muted">Datenanalyse, Visualisierung und Webapps mit sauberer Struktur.</p>
  </header>

 
<form class="filter-form" method="get">
  <div class="filter-group">
    <label for="q">Suche</label>
    <input id="q" type="text" name="q" value="{{ q }}" placeholder="Titel oder Beschreibung...">
  </div>

  <div class="filter-group">
    <label for="skill">Skill</label>
    <select id="skill" name="skill">
      <option value="">Alle Skills</option>
      {% for skill in skills %}
        <option value="{{ skill.id }}" {% if skill.id|stringformat:"s" == selected_skill %}selected{% endif %}>{{ skill }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="filter-group">
    <label class="filter-check">
      <input type="checkbox" name="featured" value="on" {% if selected_featured %}checked{% endif %}>
      <span>Nur Featured</span>
    </label>
  </div>

  <div class="filter-actions">
    <button class="btn primary" type="submit">Suchen / Filtern</button>
    <a class="btn" href="{% url 'projects' %}">Zurücksetzen</a>
  </div>
</form>


  <div class="grid cards">
    {% for p in projects %}
      <article class="card">
        <div class="project-media">
          {% if p.cover_image %}
            <img src="{{ p.cover_image.url }}" alt="{{ p.title }}">
          {% else %}
            <img src="{% static 'img/placeholder.png' %}" alt="{{ p.title }}">
          {% endif %}
        </div>
        <div class="project-body">
          <h2 class="project-title"><a href="{% url 'project_detail' p.slug %}">{{ p.title }}</a></h2>
          <p class="project-desc">{{ p.short_description }}</p>
  
          {% with skill_list=p.skills.all %}
          {% if skill_list %}
          <div class="project-skills">
            {% for skill in skill_list %}
              <span class="tag">{{ skill }}</span>
            {% endfor %}
          </div>
          {% endif %}
          {% endwith %}
        
        </div>
        <div class="project-meta">
          <div>
            {% if p.featured %}<span class="tag good">Featured</span>{% endif %}
            {% if p.tech_stack %}<span class="tag blue">{{ p.tech_stack }}</span>{% endif %}
          </div>
          <a class="link" href="{% url 'project_detail' p.slug %}">Details</a>
        </div>
      </article>
    {% empty %}
      <p class="muted">Noch keine Projekte vorhanden.</p>
    {% endfor %}
  </div>

  {% if is_paginated %}
    <nav class="pagination" aria-label="Seitennavigation">
      {% if page_obj.has_previous %}
        <a class="btn" href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_skill %}&skill={{ selected_skill }}{% endif %}{% if selected_featured %}&featured=on{% endif %}">Zurück</a>
      {% endif %}
      <span class="muted">Seite {{ page_obj.number }} von {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a class="btn" href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_skill %}&skill={{ selected_skill }}{% endif %}{% if selected_featured %}&featured=on{% endif %}">Weiter</a>
      {% endif %}
    </nav>
  {% endif %}
</section>
{% endblock %}
